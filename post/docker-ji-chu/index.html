<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Docker基础 | StackYu</title>

<link rel="shortcut icon" href="https://stackyu.github.io/favicon.ico?v=1728228395256">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://stackyu.github.io/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages//dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
    
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            StackYu
        </div>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" id="changeNavbar">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/archives" class="menu gt-a-link">
                    归档
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/tags" class="menu gt-a-link">
                    标签
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/about" class="menu gt-a-link">
                    关于
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1728228395256"
                action="/search/">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = () => {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    Docker基础
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2023-01-31 ·
                    </time>
                    
                        <a href="https://stackyu.github.io/tag/zQQ7j2mUC/" class="post-tags">
                            # Docker
                        </a>
                    
                </div>
                <div class="post-content">
                    <h1 id="1-docker概述">1. Docker概述</h1>
<blockquote>
<p>Docker是一个开源应用容器引擎，它可以将应用和依赖一起打包到可移植容器中，然后发布到任何linux或windows系统上运行，</p>
</blockquote>
<h2 id="11-如何解决不同应用依赖兼容问题">1.1 如何解决不同应用依赖兼容问题</h2>
<blockquote>
<p>Docker将应用、依赖、函数库和配置一起打包，形成可运行镜像。Docker应用运行在容器中，采用沙箱机制，相互隔离就不存在依赖兼容问题。</p>
</blockquote>
<figure data-type="image" tabindex="1"><img src="https://github.com/xiaoyu2017/JavaOffer/blob/master/img/docker0.png?raw=true" alt="" loading="lazy"></figure>
<h2 id="12-docker和虚拟机区别">1.2 Docker和虚拟机区别</h2>
<ul>
<li>Docker是系统的一个进程，模仿系统运行的环境，环境之间是相互隔离的。虚拟机模仿设备硬件，然后在模拟硬件上运行其他操作系统。</li>
<li>docker体积小，运行快，性能好。虚拟机体积大，运行慢，性能一般。</li>
</ul>
<figure data-type="image" tabindex="2"><img src="https://github.com/xiaoyu2017/JavaOffer/blob/master/img/docker1.png?raw=true" alt="" loading="lazy"></figure>
<h2 id="13-镜像和容器">1.3 镜像和容器</h2>
<p>镜像：应用及依赖打成的包称为镜像。</p>
<p>容器：通过镜像创建的运行程序被称为容器，一个镜像可以创建多个容器，之间相互隔离。</p>
<p>镜像分为两部分：<code>repository:tag</code>，在没有指定版本情况下默认是latest。</p>
<figure data-type="image" tabindex="3"><img src="https://github.com/xiaoyu2017/JavaOffer/blob/master/img/docker2.png?raw=true" alt="" loading="lazy"></figure>
<h1 id="2-基本操作">2. 基本操作</h1>
<figure data-type="image" tabindex="4"><img src="https://github.com/xiaoyu2017/JavaOffer/blob/master/img/docker4.png?raw=true" alt="" loading="lazy"></figure>
<h2 id="21-pull">2.1 pull</h2>
<blockquote>
<p>从远程仓库拉取镜像。</p>
</blockquote>
<p><code>docker pull [镜像名称][:镜像版本]</code></p>
<p>示例：<code>docker pull mysql:8.0</code></p>
<h2 id="22-images">2.2 images</h2>
<blockquote>
<p>查看所有镜像</p>
</blockquote>
<p><code>docker images</code></p>
<h2 id="23-save-load">2.3 save、load</h2>
<blockquote>
<p>将镜像导出到本地，或者从本地导入镜像。</p>
</blockquote>
<p><code>docker save -o [保存的目标文件名称] [镜像名称]</code></p>
<p>示例：<code>docker save -o nginx.tar nginx:latest</code></p>
<p>加载示例：<code>docker load -i nginx.tar</code></p>
<h2 id="24-rmi">2.4 rmi</h2>
<blockquote>
<p>删除镜像</p>
</blockquote>
<p>删除nginx镜像：<code>docker rmi nginx:latest</code></p>
<h1 id="3-容器操作">3. 容器操作</h1>
<figure data-type="image" tabindex="5"><img src="https://github.com/xiaoyu2017/JavaOffer/blob/master/img/docker5.png?raw=true" alt="" loading="lazy"></figure>
<h2 id="31-run">3.1 run</h2>
<blockquote>
<p>创建并运行一个容器，处于运行状态。</p>
</blockquote>
<p><code>docker run --name containerName -p 80:80 -d nginx</code></p>
<ul>
<li>docker run ：创建并运行一个容器</li>
<li>--name : 给容器起一个名字，比如叫做mn</li>
<li>-p ：将宿主机端口与容器端口映射，冒号左侧是宿主机端口，右侧是容器端口</li>
<li>-d：后台运行容器</li>
<li>nginx：镜像名称，例如nginx</li>
</ul>
<h2 id="32-exec">3.2 exec</h2>
<blockquote>
<p>进入容器进行操作，例如修改配置文件等。</p>
</blockquote>
<p><code>docker exec -it mn bash</code></p>
<ul>
<li>docker exec ：进入容器内部，执行一个命令</li>
<li>-it : 给当前进入的容器创建一个标准输入、输出终端，允许我们与容器交互</li>
<li>mn ：要进入的容器的名称</li>
<li>bash：进入容器后执行的命令，bash是一个linux终端交互命令</li>
</ul>
<h2 id="33-pause-unpause">3.3 pause、unpause</h2>
<blockquote>
<p>pause：让一个运行的容器暂停, unpause：让一个容器从暂停状态恢复运行。</p>
</blockquote>
<p>暂停：<code>docker pause 容器名称</code></p>
<p>暂停恢复：<code>docker unpause 容器名称</code></p>
<h2 id="34-stop-start-restart">3.4 stop、start、restart</h2>
<p>stop:<code>docker stop 容器名称</code>，停止一个容器。</p>
<p>start:<code>docker start 容器名称</code>，开始运行一个容器。</p>
<p>restart:<code>docker restart 容器名称</code>，重启一个容器。</p>
<h2 id="35-rm">3.5 rm</h2>
<blockquote>
<p>删除一个容器。</p>
</blockquote>
<p><code>docker rm [选项] [容器0，容器1...]</code></p>
<p>强制删除：<code>docker rm -f [容器0，容器1...]</code></p>
<p>删除连接网络：<code>docker rm -l [网络连接名]</code></p>
<p>删除容器，并删除容器挂载的数据卷：<code>docker rm -v [容器0，容器1...]</code></p>
<h1 id="4-数据卷操作">4. 数据卷操作</h1>
<blockquote>
<p>**数据卷（volume）**是一个虚拟目录，指向宿主机文件系统中的某个目录。不同系统可能存在差异（宿主系统）。</p>
</blockquote>
<figure data-type="image" tabindex="6"><img src="https://github.com/xiaoyu2017/JavaOffer/blob/master/img/docker3.png?raw=true" alt="" loading="lazy"></figure>
<h2 id="41-操作命令">4.1 操作命令</h2>
<p>语法：<code>docker volume [COMMAND]</code></p>
<ul>
<li>create 创建一个volume</li>
<li>inspect 显示一个或多个volume的信息</li>
<li>ls 列出所有的volume</li>
<li>prune 删除未使用的volume</li>
<li>rm 删除一个或多个指定的volume</li>
</ul>
<h2 id="42-挂载数据卷">4.2 挂载数据卷</h2>
<pre><code class="language-shell">docker run \
--name mn \
-v html:/usr/share/nginx/html \
-p 80:80 \
-d nginx
</code></pre>
<p><code>-v html:/root/htm</code> ：把html数据卷挂载到容器内的/root/html这个目录中</p>
<h1 id="5-dockerfile自定义镜像">5. Dockerfile自定义镜像</h1>
<blockquote>
<p>我们只需要告诉Docker，我们的镜像的组成，需要哪些BaseImage、需要拷贝什么文件、需要安装什么依赖、启动脚本是什么，将来Docker会帮助我们构建镜像</p>
</blockquote>
<figure data-type="image" tabindex="7"><img src="https://github.com/xiaoyu2017/JavaOffer/blob/master/img/docker7.png?raw=true" alt="" loading="lazy"></figure>
<p>示例：<br>
<img src="https://github.com/xiaoyu2017/JavaOffer/blob/master/img/docker6.png?raw=true" alt="" loading="lazy"></p>
<blockquote>
<p><strong>Dockerfile</strong>就是一个文本文件，其中包含一个个的<strong>指令(Instruction)</strong>，用指令来说明要执行什么操作来构建镜像。每一个指令都会形成一层Layer。</p>
</blockquote>
<pre><code class="language-shell"># 指定基础镜像
FROM ubuntu:16.04
# 配置环境变量，JDK的安装目录
ENV JAVA_DIR=/usr/local

# 拷贝jdk和java项目的包
COPY ./jdk8.tar.gz $JAVA_DIR/
COPY ./docker-demo.jar /tmp/app.jar

# 安装JDK
RUN cd $JAVA_DIR \
 &amp;&amp; tar -xf ./jdk8.tar.gz \
 &amp;&amp; mv ./jdk1.8.0_144 ./java8

# 配置环境变量
ENV JAVA_HOME=$JAVA_DIR/java8
ENV PATH=$PATH:$JAVA_HOME/bin

# 暴露端口
EXPOSE 8090
# 入口，java项目的启动命令
ENTRYPOINT java -jar /tmp/app.jar
</code></pre>
<p>执行构建命令即可：<code>docker build -t javaweb:1.0 .</code></p>
<blockquote>
<p>以上是比较麻烦的，也可以基于已经有的jdk环境进行配置，就比较简单。</p>
</blockquote>
<pre><code class="language-shell">FROM java:8-alpine
COPY ./app.jar /tmp/app.jar
EXPOSE 8090
ENTRYPOINT java -jar /tmp/app.jar
</code></pre>
<h1 id="6-docker-compose">6. Docker-Compose</h1>
<blockquote>
<p>Docker Compose就是一个文本文件，而无需手动一个个创建和运行容器！Compose就是一个文本文件。</p>
</blockquote>
<p>语法参考官网：<a href="https://docs.docker.com/compose/compose-file/">官网</a></p>
<p>创建Compose文件：</p>
<pre><code class="language-yaml">version: &quot;3.2&quot;

services:
  nacos:
    image: nacos/nacos-server
    environment:
      MODE: standalone
    ports:
      - &quot;8848:8848&quot;
  mysql:
    image: mysql:5.7.25
    environment:
      MYSQL_ROOT_PASSWORD: 123
    volumes:
      - &quot;$PWD/mysql/data:/var/lib/mysql&quot;
      - &quot;$PWD/mysql/conf:/etc/mysql/conf.d/&quot;
  mallUser:
    build: ./mall-user
  mallOrder:
    build: ./mall-user
  mallGateway:
    build: ./mall-gateway
    ports:
      - &quot;10010:10010&quot;
</code></pre>
<ul>
<li><code>nacos</code>：作为注册中心和配置中心
<ul>
<li><code>image: nacos/nacos-server</code>： 基于nacos/nacos-server镜像构建</li>
<li><code>environment</code>：环境变量
<ul>
<li><code>MODE: standalone</code>：单点模式启动</li>
</ul>
</li>
<li><code>ports</code>：端口映射，这里暴露了8848端口</li>
</ul>
</li>
<li><code>mysql</code>：数据库
<ul>
<li><code>image: mysql:5.7.25</code>：镜像版本是mysql:5.7.25</li>
<li><code>environment</code>：环境变量
<ul>
<li><code>MYSQL_ROOT_PASSWORD: 123</code>：设置数据库root账户的密码为123</li>
</ul>
</li>
<li><code>volumes</code>：数据卷挂载，这里挂载了mysql的data、conf目录，其中有我提前准备好的数据</li>
</ul>
</li>
<li><code>mall-user</code>、<code>mall-order</code>、<code>mall-gateway</code>：都是基于Dockerfile临时构建的</li>
</ul>
<p>新建文件目录：</p>
<figure data-type="image" tabindex="8"><img src="https://github.com/xiaoyu2017/JavaOffer/blob/master/img/docker8.png?raw=true" alt="" loading="lazy"></figure>
<blockquote>
<p>mysql目录是用于挂载目录。</p>
</blockquote>
<p>三个服务项目目录下的Dockerfile配置：</p>
<pre><code class="language-text">FROM java:8-alpine
COPY ./app.jar /tmp/app.jar
ENTRYPOINT java -jar /tmp/app.jar
</code></pre>
<p>修改服务配置文件，微服务容器之间访问使用的是容器名称访问：</p>
<pre><code class="language-yaml">spring:
  datasource:
    url: jdbc:mysql://mysql:33060/mall?useSSL=false
    username: root
    password: root
    driver-class-name: com.mysql.jdbc.Driver
  application:
    name: mall-user
  cloud:dock
  nacos:
    server-addr: nacos:8848 # nacos服务地址
</code></pre>
<p>使用maven打包服务：</p>
<pre><code class="language-xml">
&lt;build&gt;
    &lt;!-- 服务打包的最终名称 --&gt;
    &lt;finalName&gt;app&lt;/finalName&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
</code></pre>
<p>在当前目录执行构建命令：<code>docker-compose up -d</code></p>
<h1 id="8-安装docker">8. 安装Docker</h1>
<h2 id="81-centos7安装">8.1 Centos7安装</h2>
<p>卸载老版本：</p>
<pre><code class="language-shell">yum remove docker \
  docker-client \
  docker-client-latest \
  docker-common \
  docker-latest \
  docker-latest-logrotate \
  docker-logrotate \
  docker-selinux \
  docker-engine-selinux \
  docker-engine \
  docker-ce
</code></pre>
<p>安装yum：系统需要联网</p>
<pre><code class="language-shell">yum install -y yum-utils \
           device-mapper-persistent-data \
           lvm2 --skip-broken
</code></pre>
<p>设置镜像源：</p>
<pre><code class="language-shell"># 设置docker镜像源
yum-config-manager \
    --add-repo \
    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
    
sed -i 's/download.docker.com/mirrors.aliyun.com\/docker-ce/g' /etc/yum.repos.d/docker-ce.repo

yum makecache fast
</code></pre>
<p>安装docker-ce：社区免费版</p>
<pre><code class="language-shell">yum install -y docker-ce
</code></pre>
<p>docker需要使用各种端口，所以建议使用时关闭防火墙：</p>
<pre><code class="language-shell"># 关闭
systemctl stop firewalld
# 禁止开机启动防火墙
systemctl disable firewalld
</code></pre>
<p>docker的操作命令：</p>
<pre><code class="language-shell">systemctl start docker  # 启动docker服务

systemctl stop docker  # 停止docker服务

systemctl restart docker  # 重启docker服务
</code></pre>
<p>配置阿里镜像：<a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors?accounttraceid=cb36295bddcd4367b89d118e2471c930hdty">阿里镜像配置</a></p>
<h2 id="82-centos7安装dockercompose">8.2 Centos7安装DockerCompose</h2>
<p>下载安装包：</p>
<pre><code class="language-shell"># 安装
curl -L https://github.com/docker/compose/releases/download/1.23.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose
</code></pre>
<pre><code class="language-shell"># 修改权限
chmod +x /usr/local/bin/docker-compose
</code></pre>
<pre><code class="language-shell"># 补全命令
curl -L https://raw.githubusercontent.com/docker/compose/1.29.1/contrib/completion/bash/docker-compose &gt; /etc/bash_completion.d/docker-compose
</code></pre>
<p>如果有错误：<code>echo &quot;199.232.68.133 raw.githubusercontent.com&quot; &gt;&gt; /etc/hosts</code></p>
<h1 id="7-搭建docker镜像私库">7. 搭建Docker镜像私库</h1>
<h2 id="71-简化版私有仓库">7.1 简化版私有仓库</h2>
<blockquote>
<p>由Docker官网提供的简易仓库管理镜像，功能完善，但是不具备操作化界面。</p>
</blockquote>
<pre><code class="language-shell">docker run -d \
    --restart=always \
    --name registry	\
    -p 5000:5000 \
    -v registry-data:/var/lib/registry \
    registry
</code></pre>
<h2 id="72-图形界面仓库">7.2 图形界面仓库</h2>
<blockquote>
<p>使用DockerCompose部署界面化仓库</p>
</blockquote>
<pre><code class="language-yaml">version: '3.0'
services:
  registry:
    image: registry
    volumes:
      - ./registry-data:/var/lib/registry
  ui:
    image: joxit/docker-registry-ui:static
    ports:
      - 8080:80
    environment:
      - REGISTRY_TITLE=我的私有仓库
      - REGISTRY_URL=http://registry:5000
    depends_on:
      - registry
</code></pre>
<p>配置信任地址：</p>
<pre><code class="language-shell"># 打开要修改的文件
vi /etc/docker/daemon.json
# 添加内容：
&quot;insecure-registries&quot;:[&quot;http://192.168.150.101:8080&quot;]
# 重加载
systemctl daemon-reload
# 重启docker
systemctl restart docker
</code></pre>
<h1 id="9-镜像推送拉取">9. 镜像推送拉取</h1>
<p>重新tag本地镜像：<code>docker tag nginx:latest 本地仓库名称:端口/nginx:1.0 </code></p>
<p>推送镜像：<code>docker push 本地仓库名称:端口/nginx:1.0 </code></p>
<p>拉取镜像：<code>docker pull 本地仓库名称:端口/nginx:1.0 </code></p>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://stackyu.github.io/post/mybatisplus-ji-chu/" class="post-title gt-a-link">
                    MybatisPlus基础
                </a>
            </div>
        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">StackYu的个人博客</div>
    <div class="social-container">
        
            
                <a href="https://github.com/stackyu" target="_blank">
                    <i class="fab fa-github gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        
    </div>
    <div>
        Theme <a href="https://github.com/imhanjie/gridea-theme-pure" target="_blank">Pure</a>, Powered by <a
                href="https://gridea.dev" target="_blank">Gridea</a> | <a href="https://stackyu.github.io/atom.xml" target="_blank">RSS</a>
    </div>
</div>

<script>
  hljs.highlightAll()
</script>

    </div>
</div>
</body>
</html>
