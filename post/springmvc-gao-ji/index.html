<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>SpringMVC高级 | StackYu</title>

<link rel="shortcut icon" href="https://stackyu.github.io/favicon.ico?v=1728228395256">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://stackyu.github.io/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages//dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
    
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            StackYu
        </div>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" id="changeNavbar">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/archives" class="menu gt-a-link">
                    归档
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/tags" class="menu gt-a-link">
                    标签
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/about" class="menu gt-a-link">
                    关于
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1728228395256"
                action="/search/">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = () => {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    SpringMVC高级
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2023-01-23 ·
                    </time>
                    
                        <a href="https://stackyu.github.io/tag/lsvN5IMXk/" class="post-tags">
                            # SpringMVC
                        </a>
                    
                        <a href="https://stackyu.github.io/tag/E1GSjgTC3/" class="post-tags">
                            # Spring
                        </a>
                    
                        <a href="https://stackyu.github.io/tag/cMhvc0ocP/" class="post-tags">
                            # Java
                        </a>
                    
                </div>
                <div class="post-content">
                    <h1 id="1-ssm整合">1. SSM整合</h1>
<blockquote>
<p>看以下项目示例代码</p>
</blockquote>
<p>整合框架示例代码：<a href="https://github.com/xiaoyu2017/SSM">SSM</a></p>
<h1 id="2-统一返回结果">2. 统一返回结果</h1>
<pre><code class="language-java">public class RequestResult {
    private Object data;
    private Integer code;
    private String msg;

    public RequestResult() {
    }

    public RequestResult(Object data, Integer code, String msg) {
        this.data = data;
        this.code = code;
        this.msg = msg;
    }

    public Object getData() {
        return data;
    }

    public void setData(Object data) {
        this.data = data;
    }

    public Integer getCode() {
        return code;
    }

    public void setCode(Integer code) {
        this.code = code;
    }

    public String getMsg() {
        return msg;
    }

    public void setMsg(String msg) {
        this.msg = msg;
    }

    @Override
    public String toString() {
        return &quot;RequestResult{&quot; +
                &quot;data=&quot; + data +
                &quot;, code=&quot; + code +
                &quot;, msg='&quot; + msg + '\'' +
                '}';
    }

    public static class Code {
        public static final Integer SAVE_OK = 20011;
        public static final Integer DELETE_OK = 20021;
        public static final Integer UPDATE_OK = 20031;
        public static final Integer GET_OK = 20041;
        public static final Integer SAVE_ERR = 20010;
        public static final Integer DELETE_ERR = 20020;
        public static final Integer UPDATE_ERR = 20030;
        public static final Integer GET_ERR = 20040;
    }

}

@RestController
@RequestMapping(&quot;/tag&quot;)
public class TagController {

    @Autowired
    TagService tagService;

    @PostMapping
    public RequestResult save(@RequestBody Tag tag) {
        tagService.save(tag);
        RequestResult requestResult = new RequestResult();
        requestResult.setCode(RequestResult.Code.SAVE_OK);
        requestResult.setMsg(&quot;save tag success&quot;);
        return requestResult;
    }

    @GetMapping
    public RequestResult getAll() throws Exception {
        List&lt;Tag&gt; all = tagService.getAll();
        RequestResult requestResult = new RequestResult();
        requestResult.setCode(RequestResult.Code.GET_OK);
        requestResult.setMsg(&quot;save tag success&quot;);
        requestResult.setData(all);
        return requestResult;
    }

    @GetMapping(&quot;/{id}&quot;)
    public RequestResult getTagById(@PathVariable long id) throws Exception {
        Tag tag = tagService.getById(id);
        RequestResult requestResult = new RequestResult();
        requestResult.setCode(RequestResult.Code.GET_OK);
        requestResult.setMsg(&quot;save tag success&quot;);
        requestResult.setData(tag);
        return requestResult;
    }
}
</code></pre>
<h1 id="3-统一异常处理">3. 统一异常处理</h1>
<blockquote>
<p>在一个项目中随处都可能出现异常，主要的异常分为以下几种：</p>
<ol>
<li>业务异常：用户输入错误的数据格式，用户故意传递错误参数</li>
<li>系统异常：比如服务器或者数据库宕机等</li>
<li>其他异常：文件未找到等</li>
</ol>
<p>对应的异常处理：</p>
<ol>
<li>业务异常：返回友好的提示，警告用户</li>
<li>系统异常：发送固定消息，安抚用户。发送特点消息通知（邮件或短信）系统维护人员，并记录日志。</li>
<li>其他异常：发送固定消息，安抚用户。发送特点消息通知系统维护人员，并记录日志。</li>
</ol>
<p>在哪里统一处理异常了：</p>
<p>在变形层统一管理，将异常分类处理，通过AOP实现统一处理。</p>
</blockquote>
<h2 id="31-简单示例">3.1 简单示例</h2>
<p>1.创建异常处理类：</p>
<pre><code class="language-java">// 表示这是处理rest的controller的通知类
@RestControllerAdvice
public class AppExceptionAdvice {

    // 处理的异常类型
    @ExceptionHandler(Exception.class)
    public RequestResult exceptionHandle(Exception e) {
        // 此处可以发消息（短信或邮件）通知维护人员
        System.out.println(&quot;exceptionHandle get exception=&quot; + e.getMessage());
        return new RequestResult(null, RequestResult.Code.GET_ERR, &quot;系统出现异常，请稍后再试...&quot;);
    }
}
</code></pre>
<p>2.SpringMvc配置文件扫描通知：</p>
<pre><code class="language-java">@EnableWebMvc
@Configuration
// 扫描advice
@ComponentScan({&quot;cn.fishland.controller&quot;, &quot;cn.fishland.config&quot;, &quot;cn.fishland.advice&quot;})
public class SpringMvcConfig {
}
</code></pre>
<p>3.添加异常：</p>
<pre><code class="language-java">@RestController
@RequestMapping(&quot;/tag&quot;)
public class TagController {

    @Autowired
    TagService tagService;

    @GetMapping(&quot;/{id}&quot;)
    public RequestResult getTagById(@PathVariable long id) throws Exception {
        // 手动添加异常
        int x = 1 / 0;
        Tag tag = tagService.getById(id);
        RequestResult requestResult = new RequestResult();
        requestResult.setCode(RequestResult.Code.GET_OK);
        requestResult.setMsg(&quot;save tag success&quot;);
        requestResult.setData(tag);
        return requestResult;
    }
}
</code></pre>
<h2 id="32-分异常处理">3.2 分异常处理</h2>
<p>自定义分类异常</p>
<pre><code class="language-java">public class SystemException extends RuntimeException {
    private Integer code;

    public SystemException(String message, Integer code) {
        super(message);
        this.code = code;
    }

    public SystemException(String message, Integer code, Throwable cause) {
        super(message, cause);
        this.code = code;
    }

    public Integer getCode() {
        return code;
    }

    public void setCode(Integer code) {
        this.code = code;
    }
}

public class UserException extends RuntimeException {
    private Integer code;

    public UserException(String message, Integer code) {
        super(message);
        this.code = code;
    }

    public UserException(String message, Throwable cause, Integer code) {
        super(message, cause);
        this.code = code;
    }

    public Integer getCode() {
        return code;
    }

    public void setCode(Integer code) {
        this.code = code;
    }
}
</code></pre>
<p>异常处理通知类添加通知：</p>
<pre><code class="language-java">// rest风格控制器通知类
@RestControllerAdvice
public class AppExceptionAdvice {

    // 处理的异常
    @ExceptionHandler(Exception.class)
    public RequestResult exceptionHandle(Exception e) {
        // 此处可以发消息（短信或邮件）通知维护人员
        System.out.println(&quot;exceptionHandle get exception=&quot; + e.getMessage());
        return new RequestResult(null, RequestResult.Code.GET_ERR, &quot;系统出现异常，请稍后再试...&quot;);
    }

    //@ExceptionHandler用于设置当前处理器类对应的异常类型，处理系统错误通知
    @ExceptionHandler(SystemException.class)
    public RequestResult doSystemException(SystemException ex) {
        // 记录日志
        // 发送消息给运维
        // 发送邮件给开发人员,ex对象发送给开发人员
        return new RequestResult(null, ex.getCode(), ex.getMessage());
    }

    // 处理用户错误通知
    @ExceptionHandler(UserException.class)
    public RequestResult doBusinessException(UserException ex) {
        return new RequestResult(null, ex.getCode(), ex.getMessage());
    }
}
</code></pre>
<p>service层异常处理：</p>
<pre><code class="language-java">@Service
public class TagServiceImpl implements TagService {

    @Autowired
    TagDao tagDao;

    @Override
    public List&lt;Tag&gt; getAll() {
        return tagDao.selectAll();
    }

    @Override
    public Boolean save(Tag tag) {
        return tagDao.insert(tag) == 1;
    }

    @Override
    public Tag getById(long id) {
        // 模拟业务异常
        if (id == 1) {
            throw new UserException(&quot;请输入正确的id&quot;, RequestResult.Code.USER_ERR);
        }
        try {
            int x = 1 / 0;
        } catch (Exception e) {
            // 模拟系统异常
            throw new SystemException(&quot;系统出现错误，请稍后再试&quot;, RequestResult.Code.SYSTEM_ERR, e);
        }
        return tagDao.selectById(id);
    }
}
</code></pre>
<h1 id="4-拦截器">4. 拦截器</h1>
<blockquote>
<p>拦截器工作图</p>
</blockquote>
<figure data-type="image" tabindex="1"><img src="../../../img/spring10.png" alt="" loading="lazy"></figure>
<blockquote>
<p>拦截器和过滤器的不同</p>
<ol>
<li>归属不同：Filter属于Servlet技术，Interceptor属于SpringMVC技术</li>
<li>拦截内容不同：Filter对所有访问进行增强，Interceptor仅针对SpringMVC的访问进行增强</li>
</ol>
</blockquote>
<figure data-type="image" tabindex="2"><img src="../../../img/spring11.png" alt="" loading="lazy"></figure>
<h2 id="41-拦截器简单示例">4.1 拦截器简单示例</h2>
<p>1.创建拦截器：</p>
<pre><code class="language-java">// 需要Spring来管理此类
@Component
public class TagControllerInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        System.out.println(&quot;preHandle...&quot;);
        return true;
    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        System.out.println(&quot;postHandle...&quot;);
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        System.out.println(&quot;afterCompletion...&quot;);
    }
}
</code></pre>
<p>2.Spring配置扫描此类：</p>
<pre><code class="language-java">// Spring配置类
@Configuration
@EnableTransactionManagement
@PropertySource(&quot;classpath:jdbc.properties&quot;)
@Import({JdbcConfig.class, MybatisConfig.class})
// 扫描拦截器
@ComponentScan({&quot;cn.fishland.service&quot;, &quot;cn.fishland.interceptor&quot;})
public class SpringConfig {
}
</code></pre>
<p>3.SpringMvc配置拦截器：</p>
<pre><code class="language-java">@Configuration
public class WebConfig extends WebMvcConfigurationSupport {

    // 注入拦截器
    @Autowired
    TagControllerInterceptor tagControllerInterceptor;

    @Override
    protected void addResourceHandlers(ResourceHandlerRegistry registry) {
        // 第一个为拦截的请求url，第二个为本地访问url
        registry.addResourceHandler(&quot;/pages/**&quot;).addResourceLocations(&quot;/pages/&quot;);
        registry.addResourceHandler(&quot;/js/**&quot;).addResourceLocations(&quot;/js/&quot;);
        registry.addResourceHandler(&quot;/css/**&quot;).addResourceLocations(&quot;/css/&quot;);
        registry.addResourceHandler(&quot;/plugins/**&quot;).addResourceLocations(&quot;/plugins/&quot;);
    }

    // 拦截器拦截的请求url
    @Override
    protected void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(tagControllerInterceptor).addPathPatterns(&quot;/tag/*&quot;).addPathPatterns(&quot;/tag&quot;);
    }
}
</code></pre>
<p>拦截器方法运行顺序：</p>
<figure data-type="image" tabindex="3"><img src="../../../img/spring12.png" alt="" loading="lazy"></figure>
<h2 id="42-拦截器参数">4.2 拦截器参数</h2>
<ol>
<li>前置方法</li>
</ol>
<pre><code class="language-java">@Component
public class TagControllerInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest request,
                             HttpServletResponse response,
                             Object handler) throws Exception {
        System.out.println(&quot;preHandle...&quot;);
        return true;
    }
}
</code></pre>
<blockquote>
<p>在原始方法执行前执行</p>
<ol>
<li>request：请求对象</li>
<li>response：响应对象</li>
<li>handler：原始的方法method对象</li>
</ol>
</blockquote>
<ol start="5">
<li>后置方法</li>
</ol>
<pre><code class="language-java">@Component
public class TagControllerInterceptor implements HandlerInterceptor {
    @Override
    public void postHandle(HttpServletRequest request,
                           HttpServletResponse response,
                           Object handler,
                           ModelAndView modelAndView) throws Exception {
        System.out.println(&quot;postHandle...&quot;);
    }
}
</code></pre>
<blockquote>
<p>原方法执行成功后执行</p>
<ol>
<li>request：请求对象</li>
<li>response：响应对象</li>
<li>handler：原始的方法method对象</li>
<li>modelAndView：原始方法返回的数据和页面信息</li>
</ol>
</blockquote>
<ol start="3">
<li>完成后方法</li>
</ol>
<pre><code class="language-java">@Component
public class TagControllerInterceptor implements HandlerInterceptor {
    @Override
    public void afterCompletion(HttpServletRequest request,
                                HttpServletResponse response,
                                Object handler,
                                Exception ex) throws Exception {
        System.out.println(&quot;afterCompletion...&quot;);
    }
}
</code></pre>
<blockquote>
<p>原始方法之后执行，无论原始方法是否执行</p>
<ol>
<li>request：请求对象</li>
<li>response：响应对象</li>
<li>handler：原始的方法method对象</li>
<li>ex：获得原始方法可能出现的异常信息对象</li>
</ol>
</blockquote>
<h2 id="43-多拦截器执行顺序">4.3 多拦截器执行顺序</h2>
<blockquote>
<p>当一个控制器方法出现多个拦截器，执行顺序是先进后出，类似栈。顺序就是配置的顺序。</p>
</blockquote>
<figure data-type="image" tabindex="4"><img src="../../../img/spring13.png" alt="" loading="lazy"></figure>
<pre><code class="language-java">@Configuration
public class WebConfig extends WebMvcConfigurationSupport {

    // 注入拦截器
    @Autowired
    TagControllerInterceptor tagControllerInterceptor;

    @Override
    protected void addResourceHandlers(ResourceHandlerRegistry registry) {
        // 第一个为拦截的请求url，第二个为本地访问url
        registry.addResourceHandler(&quot;/pages/**&quot;).addResourceLocations(&quot;/pages/&quot;);
        registry.addResourceHandler(&quot;/js/**&quot;).addResourceLocations(&quot;/js/&quot;);
        registry.addResourceHandler(&quot;/css/**&quot;).addResourceLocations(&quot;/css/&quot;);
        registry.addResourceHandler(&quot;/plugins/**&quot;).addResourceLocations(&quot;/plugins/&quot;);
    }

    // 拦截器拦截的请求url
    @Override
    protected void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(tagControllerInterceptor).addPathPatterns(&quot;/tag/*&quot;).addPathPatterns(&quot;/tag&quot;);
        registry.addInterceptor(xxxInterceptor).addPathPatterns(&quot;/tag/*&quot;).addPathPatterns(&quot;/tag&quot;);
        registry.addInterceptor(xxxInterceptor).addPathPatterns(&quot;/tag/*&quot;).addPathPatterns(&quot;/tag&quot;);
        // ...
    }
}
</code></pre>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://stackyu.github.io/post/springmvc/" class="post-title gt-a-link">
                    SpringMVC基础
                </a>
            </div>
        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">StackYu的个人博客</div>
    <div class="social-container">
        
            
                <a href="https://github.com/stackyu" target="_blank">
                    <i class="fab fa-github gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        
    </div>
    <div>
        Theme <a href="https://github.com/imhanjie/gridea-theme-pure" target="_blank">Pure</a>, Powered by <a
                href="https://gridea.dev" target="_blank">Gridea</a> | <a href="https://stackyu.github.io/atom.xml" target="_blank">RSS</a>
    </div>
</div>

<script>
  hljs.highlightAll()
</script>

    </div>
</div>
</body>
</html>
